<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; script-src 'self' 'unsafe-inline'" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" />
  <title>Auto Typer</title>
  <style>

    :root {
      --void: #06060e;
      --deep: #0a0a18;
      --panel: rgba(8, 10, 28, 0.85);
      --border: rgba(80, 140, 255, 0.12);
      --border-glow: rgba(80, 140, 255, 0.25);
      --cyan: #4af5ff;
      --magenta: #e44fff;
      --violet: #8b5cf6;
      --star: #c8deff;
      --text: #c8d8f0;
      --dim: #4a5578;
      --input-bg: rgba(6, 6, 20, 0.7);
      --danger: #ff4a6a;
      --success: #4af5c2;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Share Tech Mono', monospace;
      background: transparent;
      color: var(--text);
      overflow: hidden;
      user-select: none;
    }

    /* â”€â”€ Outer shell with rounded corners â”€â”€â”€ */
    .shell {
      width: 100vw;
      height: 100vh;
      border-radius: 16px;
      overflow: hidden;
      position: relative;
      border: 1px solid var(--border-glow);
      background: var(--void);
    }

    /* â”€â”€ Starfield canvas â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #stars {
      position: absolute;
      inset: 0;
      z-index: 0;
      pointer-events: none;
    }

    /* â”€â”€ Nebula glow overlays â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .nebula {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.15;
      pointer-events: none;
      z-index: 0;
    }
    .nebula.a { width: 300px; height: 300px; background: var(--cyan); top: -80px; right: -60px; }
    .nebula.b { width: 250px; height: 250px; background: var(--magenta); bottom: -60px; left: -40px; }
    .nebula.c { width: 180px; height: 180px; background: var(--violet); top: 50%; left: 50%; transform: translate(-50%,-50%); opacity: 0.08; }

    /* â”€â”€ Title bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .titlebar {
      position: relative;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px 0;
      -webkit-app-region: drag;
    }
    .brand {
      font-family: 'Orbitron', sans-serif;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.2em;
      background: linear-gradient(135deg, var(--cyan), var(--magenta));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(74, 245, 255, 0.3);
    }
    .brand::before {
      content: 'âœ¦ ';
      -webkit-text-fill-color: var(--cyan);
      font-size: 9px;
    }
    .wcontrols {
      display: flex;
      gap: 6px;
      -webkit-app-region: no-drag;
    }
    .wcontrols button {
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      color: var(--dim);
      width: 26px; height: 26px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }
    .wcontrols button:hover { background: rgba(255,255,255,0.08); color: var(--text); border-color: var(--border-glow); }
    .wcontrols .close:hover { background: rgba(255,70,106,0.15); color: var(--danger); border-color: rgba(255,70,106,0.3); }

    /* â”€â”€ Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .content {
      position: relative;
      z-index: 2;
      padding: 14px 18px 18px;
      -webkit-app-region: no-drag;
    }

    label {
      font-family: 'Orbitron', sans-serif;
      font-size: 9px;
      color: var(--dim);
      letter-spacing: 0.16em;
      text-transform: uppercase;
    }

    textarea {
      display: block;
      width: 100%;
      margin: 6px 0 14px;
      background: var(--input-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-family: 'Share Tech Mono', monospace;
      font-size: 12.5px;
      padding: 10px 12px;
      resize: vertical;
      min-height: 110px;
      max-height: 200px;
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s;
      line-height: 1.5;
    }
    textarea::placeholder { color: var(--dim); font-size: 11px; }
    textarea:focus {
      border-color: var(--cyan);
      box-shadow: 0 0 20px rgba(74,245,255,0.08), inset 0 0 20px rgba(74,245,255,0.03);
    }

    .row {
      display: flex;
      gap: 10px;
      margin-bottom: 14px;
    }
    .row > div { flex: 1; }

    input[type="number"],
    input[type="text"] {
      display: block;
      width: 100%;
      margin-top: 5px;
      background: var(--input-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-family: 'Share Tech Mono', monospace;
      font-size: 13px;
      padding: 8px 10px;
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    input:focus {
      border-color: var(--cyan);
      box-shadow: 0 0 16px rgba(74,245,255,0.08);
    }

    .hotkey-input {
      color: var(--cyan) !important;
      cursor: pointer;
      text-align: center;
      caret-color: transparent;
    }
    .hotkey-input.capturing {
      color: var(--magenta) !important;
      border-color: var(--magenta) !important;
      box-shadow: 0 0 20px rgba(228,79,255,0.15) !important;
      animation: pulse 1.2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }

    /* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .actions {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .btn-launch {
      flex: 1;
      position: relative;
      background: linear-gradient(135deg, rgba(74,245,255,0.15), rgba(139,92,246,0.15));
      border: 1px solid rgba(74,245,255,0.3);
      color: var(--cyan);
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 12px;
      letter-spacing: 0.1em;
      padding: 11px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.25s;
      overflow: hidden;
    }
    .btn-launch::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, var(--cyan), var(--violet));
      opacity: 0;
      transition: opacity 0.25s;
      z-index: 0;
    }
    .btn-launch span { position: relative; z-index: 1; }
    .btn-launch:hover::before { opacity: 0.2; }
    .btn-launch:hover { border-color: var(--cyan); box-shadow: 0 0 25px rgba(74,245,255,0.15); }
    .btn-launch:active { transform: scale(0.97); }

    .btn-launch.stop {
      background: linear-gradient(135deg, rgba(255,74,106,0.15), rgba(255,74,106,0.05));
      border-color: rgba(255,74,106,0.4);
      color: var(--danger);
    }
    .btn-launch.stop::before { background: var(--danger); }
    .btn-launch.stop:hover { box-shadow: 0 0 25px rgba(255,74,106,0.15); }

    .btn-pin {
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border);
      color: var(--dim);
      font-family: 'Share Tech Mono', monospace;
      font-size: 11px;
      padding: 11px 13px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }
    .btn-pin:hover { background: rgba(255,255,255,0.06); color: var(--text); }
    .btn-pin.active { color: var(--cyan); border-color: rgba(74,245,255,0.25); }

    /* â”€â”€ Progress bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .progress-wrap {
      margin-top: 14px;
      height: 3px;
      background: rgba(255,255,255,0.04);
      border-radius: 3px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--cyan), var(--magenta));
      border-radius: 3px;
      transition: width 0.15s linear;
      box-shadow: 0 0 10px rgba(74,245,255,0.4);
    }

    /* â”€â”€ Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .status {
      margin-top: 10px;
      font-size: 11px;
      min-height: 16px;
      padding: 9px 12px;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border);
      border-radius: 10px;
      text-align: center;
      transition: all 0.3s;
    }
    .status.idle { color: var(--dim); }
    .status.typing { color: var(--cyan); border-color: rgba(74,245,255,0.15); }
    .status.done { color: var(--success); border-color: rgba(74,245,194,0.15); }
    .status.error { color: var(--danger); border-color: rgba(255,74,106,0.15); }
    .status.stopped { color: #ffaa57; border-color: rgba(255,170,87,0.15); }

    kbd {
      background: rgba(255,255,255,0.06);
      padding: 1px 6px;
      border-radius: 4px;
      font-size: 10px;
      color: var(--cyan);
      border: 1px solid var(--border);
      font-family: 'Orbitron', sans-serif;
    }

    /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .footer {
      margin-top: 12px;
      font-size: 9px;
      color: var(--dim);
      text-align: center;
      line-height: 1.6;
      letter-spacing: 0.04em;
      opacity: 0.6;
    }
  </style>
</head>
<body>
<div class="shell">
  <canvas id="stars"></canvas>
  <div class="nebula a"></div>
  <div class="nebula b"></div>
  <div class="nebula c"></div>

  <div class="titlebar">
    <span class="brand">AUTO TYPER</span>
    <div class="wcontrols">
      <button class="min" onclick="window.api.minimize()" title="Minimize">â”€</button>
      <button class="close" onclick="window.api.close()" title="Close">âœ•</button>
    </div>
  </div>

  <div class="content">
    <label for="text">Transmission</label>
    <textarea id="text" placeholder="Enter text payload..." spellcheck="false"></textarea>

    <div class="row">
      <div>
        <label for="speed">Chars / sec</label>
        <input type="number" id="speed" value="20" min="1" max="500" step="5" />
      </div>
      <div>
        <label for="hotkey">Hotkey</label>
        <input type="text" id="hotkey" class="hotkey-input" value="F2" readonly title="Click to rebind" />
      </div>
    </div>

    <div class="actions">
      <button class="btn-launch" id="startBtn"><span>â–¸ LAUNCH</span></button>
      <button class="btn-pin active" id="aotBtn" title="Always on top">ðŸ“Œ AOT</button>
    </div>

    <div class="progress-wrap"><div class="progress-bar" id="progress"></div></div>

    <div class="status idle" id="status">
      Press <kbd>F2</kbd> in target window to transmit Â· <kbd>ESC</kbd> to abort
    </div>

    <div class="footer">
      focus target â†’ press hotkey â†’ characters transmit one by one
    </div>
  </div>
</div>

<script>
// â”€â”€ Starfield â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function initStars() {
  const canvas = document.getElementById("stars");
  const ctx = canvas.getContext("2d");
  let w, h, stars = [];
  const COUNT = 90;

  function resize() {
    w = canvas.width = canvas.offsetWidth;
    h = canvas.height = canvas.offsetHeight;
  }

  function spawn() {
    stars = [];
    for (let i = 0; i < COUNT; i++) {
      stars.push({
        x: Math.random() * w,
        y: Math.random() * h,
        r: Math.random() * 1.2 + 0.3,
        a: Math.random(),
        da: (Math.random() - 0.5) * 0.008,
      });
    }
  }

  function draw() {
    ctx.clearRect(0, 0, w, h);
    for (const s of stars) {
      s.a += s.da;
      if (s.a > 1 || s.a < 0.1) s.da *= -1;
      s.a = Math.max(0.08, Math.min(1, s.a));
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(200, 222, 255, ${s.a})`;
      ctx.fill();
    }
    requestAnimationFrame(draw);
  }

  resize();
  spawn();
  draw();
  window.addEventListener("resize", () => { resize(); spawn(); });
})();

// â”€â”€ Elements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const textEl = document.getElementById("text");
const speedEl = document.getElementById("speed");
const hotkeyEl = document.getElementById("hotkey");
const startBtn = document.getElementById("startBtn");
const aotBtn = document.getElementById("aotBtn");
const statusEl = document.getElementById("status");
const progressEl = document.getElementById("progress");

let typing = false;
let capturing = false;

// â”€â”€ Hotkey capture â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
hotkeyEl.addEventListener("click", () => {
  capturing = true;
  hotkeyEl.value = "...";
  hotkeyEl.classList.add("capturing");
});

document.addEventListener("keydown", async (e) => {
  if (!capturing) return;
  e.preventDefault();
  capturing = false;
  hotkeyEl.classList.remove("capturing");
  const key = mapKey(e);
  hotkeyEl.value = key;
  const ok = await window.api.registerHotkey(key);
  if (!ok) {
    statusEl.className = "status error";
    statusEl.innerHTML = `Failed to bind <kbd>${key}</kbd> â€” try another`;
  } else {
    statusEl.className = "status idle";
    statusEl.innerHTML = `Press <kbd>${key}</kbd> in target window to transmit Â· <kbd>ESC</kbd> to abort`;
  }
});

function mapKey(e) {
  const map = { " ": "Space", ArrowUp: "Up", ArrowDown: "Down", ArrowLeft: "Left", ArrowRight: "Right" };
  let key = map[e.key] || e.key;
  if (/^F\d+$/.test(key)) return key;
  if (key.length === 1) key = key.toUpperCase();
  let a = "";
  if (e.ctrlKey) a += "CommandOrControl+";
  if (e.altKey) a += "Alt+";
  if (e.shiftKey && key.length > 1) a += "Shift+";
  return a + key;
}

// â”€â”€ Start / stop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
startBtn.addEventListener("click", () => {
  if (typing) window.api.stopTyping();
  else sendText();
});

function sendText() {
  const text = textEl.value;
  const speed = parseFloat(speedEl.value) || 20;
  if (!text.trim()) {
    statusEl.className = "status error";
    statusEl.textContent = "No payload entered.";
    return;
  }
  progressEl.style.width = "0%";
  window.api.startTyping(text, speed);
}

// â”€â”€ IPC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.api.onRequestText(() => sendText());

window.api.onTypingStatus((d) => {
  const key = hotkeyEl.value;
  switch (d.state) {
    case "typing":
      typing = true;
      startBtn.innerHTML = "<span>â–  ABORT</span>";
      startBtn.classList.add("stop");
      statusEl.className = "status typing";
      if (d.total) {
        const pct = Math.round((d.done / d.total) * 100);
        statusEl.textContent = `Transmitting... ${pct}%`;
        progressEl.style.width = pct + "%";
      } else {
        statusEl.textContent = "Transmitting...";
      }
      break;
    case "done":
      typing = false;
      startBtn.innerHTML = "<span>â–¸ LAUNCH</span>";
      startBtn.classList.remove("stop");
      statusEl.className = "status done";
      statusEl.innerHTML = `Transmission complete Â· press <kbd>${key}</kbd> to repeat`;
      progressEl.style.width = "100%";
      setTimeout(() => { progressEl.style.width = "0%"; }, 2000);
      break;
    case "stopped":
      typing = false;
      startBtn.innerHTML = "<span>â–¸ LAUNCH</span>";
      startBtn.classList.remove("stop");
      statusEl.className = "status stopped";
      statusEl.textContent = "Transmission aborted.";
      progressEl.style.width = "0%";
      break;
    case "error":
      typing = false;
      startBtn.innerHTML = "<span>â–¸ LAUNCH</span>";
      startBtn.classList.remove("stop");
      statusEl.className = "status error";
      statusEl.textContent = "Signal lost â€” is a window focused?";
      progressEl.style.width = "0%";
      break;
  }
});

// â”€â”€ AOT toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let aot = true;
aotBtn.addEventListener("click", async () => {
  aot = await window.api.toggleAOT();
  aotBtn.classList.toggle("active", aot);
});
</script>
</body>
</html>
